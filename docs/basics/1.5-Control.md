

---

## âœ… Cheatsheet: Elixir Control Structures

### `if`

* Works like any language, but only `false` and `nil` are falsy.

```elixir
if String.valid?("Hello") do
  "Valid"
else
  "Invalid"
end
```

---

### `case`

* Pattern matching on multiple possible values.

```elixir
status = {:ok, "Hello"}

case status do
  {:ok, msg} -> msg
  {:error} -> "Error"
  _ -> "Catch all"
end
```

ðŸ‘‰ `_` is like `else`.
ðŸ‘‰ `^var` is used to pin existing values (not rebind).

With guards:

```elixir
case {1, 2, 3} do
  {1, x, 3} when x > 0 -> "Match"
  _ -> "No match"
end
```

---

### `cond`

* Like `if / else if` chains.

```elixir
cond do
  2 + 2 == 5 -> "nope"
  2 * 2 == 3 -> "wrong"
  1 + 1 == 2 -> "yes"
  true -> "fallback"
end
```

---

### `with`

* Used to **clean up nested case/if chains**.
* Each step **must return a pattern that matches**, otherwise it returns the non-matching value.
* Think of it like **linear success flow**, otherwise stop.

Without `with`:

```elixir
case Repo.insert(changeset) do
  {:ok, user} ->
    case Guardian.encode_and_sign(user, :token) do
      {:ok, token} -> important_stuff(token)
      err -> err
    end
  err -> err
end
```

With `with`:

```elixir
with {:ok, user} <- Repo.insert(changeset),
     {:ok, token} <- Guardian.encode_and_sign(user, :token) do
  important_stuff(token)
end
```

ðŸ‘‰ Cleaner. Each `<-` is like a **match requirement**.

With `else` for error handling:

```elixir
with {:ok, number} <- Map.fetch(%{a: 1}, :a),
     true <- Integer.is_even(number) do
  "Even number!"
else
  :error -> "Key not found"
  false -> "Odd number"
end
```

---

## ðŸ§  How to Think About `with`

* Imagine it as **case chaining in a straight line**.
* Each step **must succeed**, otherwise it stops early.
* `else` gives you a chance to handle failures gracefully.

Equivalent using `case`:

```elixir
case Map.fetch(%{a: 1}, :a) do
  {:ok, number} ->
    case Integer.is_even(number) do
      true -> "Even"
      false -> "Odd"
    end
  :error -> "Key not found"
end
```

ðŸ‘‰ See how much nesting `case` creates? `with` flattens it.

---

So the **hierarchy of usage**:

* Use `if` â†’ for simple true/false.
* Use `case` â†’ when branching on **different patterns**.
* Use `cond` â†’ when checking **different conditions**.
* Use `with` â†’ when chaining **multiple success/fail operations**.

---
